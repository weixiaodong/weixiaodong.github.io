<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>go-cobra包源码阅读 | 学习记录</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  
  
    <link rel="alternate" href="/atom.xml" title="学习记录" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
    
<link rel="stylesheet" href="/localshare/css/share.css">

  
  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">学习记录</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/."><i class="fa fa-home"></i> 首页</a>
        
          <a class="main-nav-link" href="/archives/"><i class="fa fa-archive"></i> 归档</a>
        
          <a class="main-nav-link" href="/about/"><i class="fa fa-user"></i> 关于</a>
        
      </nav>
    </div>
    <div id="search-form">
      <div id="result-mask" class="hide"></div>
      <label><input id="search-key" type="text" autocomplete="off" placeholder="搜索"></label>
      <div id="result-wrap" class="hide">
        <div id="search-result"></div>
      </div>
      <div class="hide">
        <template id="search-tpl">
          <div class="item">
            <a href="/{path}" title="{title}">
              <div class="title">{title}</div>
              <div class="time">{date}</div>
              <div class="tags">{tags}</div>
            </a>
          </div>
        </template>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-go-cobra包源码阅读" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      go-cobra包源码阅读
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2023-03-10T13:27:35.000Z" itemprop="datePublished">2023年03月10日</time>
</span>
      
      
        <span class="article-views">
  <i class="fa fa-views"></i>
  <i id="busuanzi_container_page_pv">
      <i id="busuanzi_value_page_pv"></i>
  </i>
</span>

      
      
<a href="/2023/03/10/go-cobra%E5%8C%85%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/#comments" class="article-comment-link">
  
    
      <span class="post-comments-count valine-comment-count" data-xid="/2023/03/10/go-cobra%E5%8C%85%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/" itemprop="commentCount"></span>
    
    
    
    
    
  
  <i class="fa fa-commt"></i>
  留言
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="command-结构"><a href="#command-结构" class="headerlink" title="command 结构"></a>command 结构</h2><span id="more"></span>

<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Command <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="comment">// Use is the one-line usage message.</span></span><br><span class="line">	<span class="comment">// Recommended syntax is as follows:</span></span><br><span class="line">	<span class="comment">//   [ ] identifies an optional argument. Arguments that are not enclosed in brackets are required.</span></span><br><span class="line">	<span class="comment">//   ... indicates that you can specify multiple values for the previous argument.</span></span><br><span class="line">	<span class="comment">//   |   indicates mutually exclusive information. You can use the argument to the left of the separator or the</span></span><br><span class="line">	<span class="comment">//       argument to the right of the separator. You cannot use both arguments in a single use of the command.</span></span><br><span class="line">	<span class="comment">//   &#123; &#125; delimits a set of mutually exclusive arguments when one of the arguments is required. If the arguments are</span></span><br><span class="line">	<span class="comment">//       optional, they are enclosed in brackets ([ ]).</span></span><br><span class="line">	<span class="comment">// Example: add [-F file | -D dir]... [-f format] profile</span></span><br><span class="line">	Use <span class="type">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Aliases is an array of aliases that can be used instead of the first word in Use.</span></span><br><span class="line">	Aliases []<span class="type">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// SuggestFor is an array of command names for which this command will be suggested -</span></span><br><span class="line">	<span class="comment">// similar to aliases but only suggests.</span></span><br><span class="line">	SuggestFor []<span class="type">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Short is the short description shown in the &#x27;help&#x27; output.</span></span><br><span class="line">	Short <span class="type">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// The group id under which this subcommand is grouped in the &#x27;help&#x27; output of its parent.</span></span><br><span class="line">	GroupID <span class="type">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Long is the long message shown in the &#x27;help &lt;this-command&gt;&#x27; output.</span></span><br><span class="line">	Long <span class="type">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Example is examples of how to use the command.</span></span><br><span class="line">	Example <span class="type">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// ValidArgs is list of all valid non-flag arguments that are accepted in shell completions</span></span><br><span class="line">	ValidArgs []<span class="type">string</span></span><br><span class="line">	<span class="comment">// ValidArgsFunction is an optional function that provides valid non-flag arguments for shell completion.</span></span><br><span class="line">	<span class="comment">// It is a dynamic version of using ValidArgs.</span></span><br><span class="line">	<span class="comment">// Only one of ValidArgs and ValidArgsFunction can be used for a command.</span></span><br><span class="line">	ValidArgsFunction <span class="function"><span class="keyword">func</span><span class="params">(cmd *Command, args []<span class="type">string</span>, toComplete <span class="type">string</span>)</span></span> ([]<span class="type">string</span>, ShellCompDirective)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Expected arguments</span></span><br><span class="line">	Args PositionalArgs</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ArgAliases is List of aliases for ValidArgs.</span></span><br><span class="line">	<span class="comment">// These are not suggested to the user in the shell completion,</span></span><br><span class="line">	<span class="comment">// but accepted if entered manually.</span></span><br><span class="line">	ArgAliases []<span class="type">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// BashCompletionFunction is custom bash functions used by the legacy bash autocompletion generator.</span></span><br><span class="line">	<span class="comment">// For portability with other shells, it is recommended to instead use ValidArgsFunction</span></span><br><span class="line">	BashCompletionFunction <span class="type">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Deprecated defines, if this command is deprecated and should print this string when used.</span></span><br><span class="line">	Deprecated <span class="type">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Annotations are key/value pairs that can be used by applications to identify or</span></span><br><span class="line">	<span class="comment">// group commands.</span></span><br><span class="line">	Annotations <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Version defines the version for this command. If this value is non-empty and the command does not</span></span><br><span class="line">	<span class="comment">// define a &quot;version&quot; flag, a &quot;version&quot; boolean flag will be added to the command and, if specified,</span></span><br><span class="line">	<span class="comment">// will print content of the &quot;Version&quot; variable. A shorthand &quot;v&quot; flag will also be added if the</span></span><br><span class="line">	<span class="comment">// command does not define one.</span></span><br><span class="line">	Version <span class="type">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// The *Run functions are executed in the following order:</span></span><br><span class="line">	<span class="comment">//   * PersistentPreRun()</span></span><br><span class="line">	<span class="comment">//   * PreRun()</span></span><br><span class="line">	<span class="comment">//   * Run()</span></span><br><span class="line">	<span class="comment">//   * PostRun()</span></span><br><span class="line">	<span class="comment">//   * PersistentPostRun()</span></span><br><span class="line">	<span class="comment">// All functions get the same args, the arguments after the command name.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// PersistentPreRun: children of this command will inherit and execute.</span></span><br><span class="line">	PersistentPreRun <span class="function"><span class="keyword">func</span><span class="params">(cmd *Command, args []<span class="type">string</span>)</span></span></span><br><span class="line">	<span class="comment">// PersistentPreRunE: PersistentPreRun but returns an error.</span></span><br><span class="line">	PersistentPreRunE <span class="function"><span class="keyword">func</span><span class="params">(cmd *Command, args []<span class="type">string</span>)</span></span> <span class="type">error</span></span><br><span class="line">	<span class="comment">// PreRun: children of this command will not inherit.</span></span><br><span class="line">	PreRun <span class="function"><span class="keyword">func</span><span class="params">(cmd *Command, args []<span class="type">string</span>)</span></span></span><br><span class="line">	<span class="comment">// PreRunE: PreRun but returns an error.</span></span><br><span class="line">	PreRunE <span class="function"><span class="keyword">func</span><span class="params">(cmd *Command, args []<span class="type">string</span>)</span></span> <span class="type">error</span></span><br><span class="line">	<span class="comment">// Run: Typically the actual work function. Most commands will only implement this.</span></span><br><span class="line">	Run <span class="function"><span class="keyword">func</span><span class="params">(cmd *Command, args []<span class="type">string</span>)</span></span></span><br><span class="line">	<span class="comment">// RunE: Run but returns an error.</span></span><br><span class="line">	RunE <span class="function"><span class="keyword">func</span><span class="params">(cmd *Command, args []<span class="type">string</span>)</span></span> <span class="type">error</span></span><br><span class="line">	<span class="comment">// PostRun: run after the Run command.</span></span><br><span class="line">	PostRun <span class="function"><span class="keyword">func</span><span class="params">(cmd *Command, args []<span class="type">string</span>)</span></span></span><br><span class="line">	<span class="comment">// PostRunE: PostRun but returns an error.</span></span><br><span class="line">	PostRunE <span class="function"><span class="keyword">func</span><span class="params">(cmd *Command, args []<span class="type">string</span>)</span></span> <span class="type">error</span></span><br><span class="line">	<span class="comment">// PersistentPostRun: children of this command will inherit and execute after PostRun.</span></span><br><span class="line">	PersistentPostRun <span class="function"><span class="keyword">func</span><span class="params">(cmd *Command, args []<span class="type">string</span>)</span></span></span><br><span class="line">	<span class="comment">// PersistentPostRunE: PersistentPostRun but returns an error.</span></span><br><span class="line">	PersistentPostRunE <span class="function"><span class="keyword">func</span><span class="params">(cmd *Command, args []<span class="type">string</span>)</span></span> <span class="type">error</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// groups for subcommands</span></span><br><span class="line">	commandgroups []*Group</span><br><span class="line"></span><br><span class="line">	<span class="comment">// args is actual args parsed from flags.</span></span><br><span class="line">	args []<span class="type">string</span></span><br><span class="line">	<span class="comment">// flagErrorBuf contains all error messages from pflag.</span></span><br><span class="line">	flagErrorBuf *bytes.Buffer</span><br><span class="line">	<span class="comment">// flags is full set of flags.</span></span><br><span class="line">	flags *flag.FlagSet</span><br><span class="line">	<span class="comment">// pflags contains persistent flags.</span></span><br><span class="line">	pflags *flag.FlagSet</span><br><span class="line">	<span class="comment">// lflags contains local flags.</span></span><br><span class="line">	lflags *flag.FlagSet</span><br><span class="line">	<span class="comment">// iflags contains inherited flags.</span></span><br><span class="line">	iflags *flag.FlagSet</span><br><span class="line">	<span class="comment">// parentsPflags is all persistent flags of cmd&#x27;s parents.</span></span><br><span class="line">	parentsPflags *flag.FlagSet</span><br><span class="line">	<span class="comment">// globNormFunc is the global normalization function</span></span><br><span class="line">	<span class="comment">// that we can use on every pflag set and children commands</span></span><br><span class="line">	globNormFunc <span class="function"><span class="keyword">func</span><span class="params">(f *flag.FlagSet, name <span class="type">string</span>)</span></span> flag.NormalizedName</span><br><span class="line"></span><br><span class="line">	<span class="comment">// usageFunc is usage func defined by user.</span></span><br><span class="line">	usageFunc <span class="function"><span class="keyword">func</span><span class="params">(*Command)</span></span> <span class="type">error</span></span><br><span class="line">	<span class="comment">// usageTemplate is usage template defined by user.</span></span><br><span class="line">	usageTemplate <span class="type">string</span></span><br><span class="line">	<span class="comment">// flagErrorFunc is func defined by user and it&#x27;s called when the parsing of</span></span><br><span class="line">	<span class="comment">// flags returns an error.</span></span><br><span class="line">	flagErrorFunc <span class="function"><span class="keyword">func</span><span class="params">(*Command, <span class="type">error</span>)</span></span> <span class="type">error</span></span><br><span class="line">	<span class="comment">// helpTemplate is help template defined by user.</span></span><br><span class="line">	helpTemplate <span class="type">string</span></span><br><span class="line">	<span class="comment">// helpFunc is help func defined by user.</span></span><br><span class="line">	helpFunc <span class="function"><span class="keyword">func</span><span class="params">(*Command, []<span class="type">string</span>)</span></span></span><br><span class="line">	<span class="comment">// helpCommand is command with usage &#x27;help&#x27;. If it&#x27;s not defined by user,</span></span><br><span class="line">	<span class="comment">// cobra uses default help command.</span></span><br><span class="line">	helpCommand *Command</span><br><span class="line">	<span class="comment">// helpCommandGroupID is the group id for the helpCommand</span></span><br><span class="line">	helpCommandGroupID <span class="type">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// completionCommandGroupID is the group id for the completion command</span></span><br><span class="line">	completionCommandGroupID <span class="type">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// versionTemplate is the version template defined by user.</span></span><br><span class="line">	versionTemplate <span class="type">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// inReader is a reader defined by the user that replaces stdin</span></span><br><span class="line">	inReader io.Reader</span><br><span class="line">	<span class="comment">// outWriter is a writer defined by the user that replaces stdout</span></span><br><span class="line">	outWriter io.Writer</span><br><span class="line">	<span class="comment">// errWriter is a writer defined by the user that replaces stderr</span></span><br><span class="line">	errWriter io.Writer</span><br><span class="line"></span><br><span class="line">	<span class="comment">// FParseErrWhitelist flag parse errors to be ignored</span></span><br><span class="line">	FParseErrWhitelist FParseErrWhitelist</span><br><span class="line"></span><br><span class="line">	<span class="comment">// CompletionOptions is a set of options to control the handling of shell completion</span></span><br><span class="line">	CompletionOptions CompletionOptions</span><br><span class="line"></span><br><span class="line">	<span class="comment">// commandsAreSorted defines, if command slice are sorted or not.</span></span><br><span class="line">	commandsAreSorted <span class="type">bool</span></span><br><span class="line">	<span class="comment">// commandCalledAs is the name or alias value used to call this command.</span></span><br><span class="line">	commandCalledAs <span class="keyword">struct</span> &#123;</span><br><span class="line">		name   <span class="type">string</span></span><br><span class="line">		called <span class="type">bool</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	ctx context.Context</span><br><span class="line"></span><br><span class="line">	<span class="comment">// commands is the list of commands supported by this program.</span></span><br><span class="line">	commands []*Command</span><br><span class="line">	<span class="comment">// parent is a parent command for this command.</span></span><br><span class="line">	parent *Command</span><br><span class="line">	<span class="comment">// Max lengths of commands&#x27; string lengths for use in padding.</span></span><br><span class="line">	commandsMaxUseLen         <span class="type">int</span></span><br><span class="line">	commandsMaxCommandPathLen <span class="type">int</span></span><br><span class="line">	commandsMaxNameLen        <span class="type">int</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// TraverseChildren parses flags on all parents before executing child command.</span></span><br><span class="line">	TraverseChildren <span class="type">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Hidden defines, if this command is hidden and should NOT show up in the list of available commands.</span></span><br><span class="line">	Hidden <span class="type">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// SilenceErrors is an option to quiet errors down stream.</span></span><br><span class="line">	SilenceErrors <span class="type">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// SilenceUsage is an option to silence usage when an error occurs.</span></span><br><span class="line">	SilenceUsage <span class="type">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// DisableFlagParsing disables the flag parsing.</span></span><br><span class="line">	<span class="comment">// If this is true all flags will be passed to the command as arguments.</span></span><br><span class="line">	DisableFlagParsing <span class="type">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// DisableAutoGenTag defines, if gen tag (&quot;Auto generated by spf13/cobra...&quot;)</span></span><br><span class="line">	<span class="comment">// will be printed by generating docs for this command.</span></span><br><span class="line">	DisableAutoGenTag <span class="type">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// DisableFlagsInUseLine will disable the addition of [flags] to the usage</span></span><br><span class="line">	<span class="comment">// line of a command when printing help or generating docs</span></span><br><span class="line">	DisableFlagsInUseLine <span class="type">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// DisableSuggestions disables the suggestions based on Levenshtein distance</span></span><br><span class="line">	<span class="comment">// that go along with &#x27;unknown command&#x27; messages.</span></span><br><span class="line">	DisableSuggestions <span class="type">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// SuggestionsMinimumDistance defines minimum levenshtein distance to display suggestions.</span></span><br><span class="line">	<span class="comment">// Must be &gt; 0.</span></span><br><span class="line">	SuggestionsMinimumDistance <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="AddCommand-方法"><a href="#AddCommand-方法" class="headerlink" title="AddCommand 方法"></a>AddCommand 方法</h2><p>AddCommand 设置子command的parent，以及parent的子commands列表</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AddCommand adds one or more commands to this parent command.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Command)</span></span> AddCommand(cmds ...*Command) &#123;</span><br><span class="line">	<span class="keyword">for</span> i, x := <span class="keyword">range</span> cmds &#123;</span><br><span class="line">		<span class="keyword">if</span> cmds[i] == c &#123;</span><br><span class="line">			<span class="built_in">panic</span>(<span class="string">&quot;Command can&#x27;t be a child of itself&quot;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		cmds[i].parent = c</span><br><span class="line">		<span class="comment">// update max lengths</span></span><br><span class="line">		usageLen := <span class="built_in">len</span>(x.Use)</span><br><span class="line">		<span class="keyword">if</span> usageLen &gt; c.commandsMaxUseLen &#123;</span><br><span class="line">			c.commandsMaxUseLen = usageLen</span><br><span class="line">		&#125;</span><br><span class="line">		commandPathLen := <span class="built_in">len</span>(x.CommandPath())</span><br><span class="line">		<span class="keyword">if</span> commandPathLen &gt; c.commandsMaxCommandPathLen &#123;</span><br><span class="line">			c.commandsMaxCommandPathLen = commandPathLen</span><br><span class="line">		&#125;</span><br><span class="line">		nameLen := <span class="built_in">len</span>(x.Name())</span><br><span class="line">		<span class="keyword">if</span> nameLen &gt; c.commandsMaxNameLen &#123;</span><br><span class="line">			c.commandsMaxNameLen = nameLen</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// If global normalization function exists, update all children</span></span><br><span class="line">		<span class="keyword">if</span> c.globNormFunc != <span class="literal">nil</span> &#123;</span><br><span class="line">			x.SetGlobalNormalizationFunc(c.globNormFunc)</span><br><span class="line">		&#125;</span><br><span class="line">		c.commands = <span class="built_in">append</span>(c.commands, x)</span><br><span class="line">		c.commandsAreSorted = <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Execute-方法"><a href="#Execute-方法" class="headerlink" title="Execute 方法"></a>Execute 方法</h2><p>Execute方法会先根据args(os.Args[1:]) find 到具体的子cmd，然后执行子cmd的execute方法</p>
<p>ExecuteC -&gt; Find -&gt; findNext -&gt; execute</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Execute uses the args (os.Args[1:] by default)</span></span><br><span class="line"><span class="comment">// and run through the command tree finding appropriate matches</span></span><br><span class="line"><span class="comment">// for commands and then corresponding flags.</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Command)</span></span> Execute() <span class="type">error</span> &#123;</span><br><span class="line">	_, err := c.ExecuteC()</span><br><span class="line">	<span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ExecuteC executes the command.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Command)</span></span> ExecuteC() (cmd *Command, err <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span> c.ctx == <span class="literal">nil</span> &#123;</span><br><span class="line">		c.ctx = context.Background()</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Regardless of what command execute is called on, run on Root only</span></span><br><span class="line">	<span class="keyword">if</span> c.HasParent() &#123;</span><br><span class="line">		<span class="keyword">return</span> c.Root().ExecuteC()</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// windows hook</span></span><br><span class="line">	<span class="keyword">if</span> preExecHookFn != <span class="literal">nil</span> &#123;</span><br><span class="line">		preExecHookFn(c)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// initialize help at the last point to allow for user overriding</span></span><br><span class="line">	c.InitDefaultHelpCmd()</span><br><span class="line">	<span class="comment">// initialize completion at the last point to allow for user overriding</span></span><br><span class="line">	c.InitDefaultCompletionCmd()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Now that all commands have been created, let&#x27;s make sure all groups</span></span><br><span class="line">	<span class="comment">// are properly created also</span></span><br><span class="line">	c.checkCommandGroups()</span><br><span class="line"></span><br><span class="line">	args := c.args</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Workaround FAIL with &quot;go test -v&quot; or &quot;cobra.test -test.v&quot;, see #155</span></span><br><span class="line">	<span class="keyword">if</span> c.args == <span class="literal">nil</span> &amp;&amp; filepath.Base(os.Args[<span class="number">0</span>]) != <span class="string">&quot;cobra.test&quot;</span> &#123;</span><br><span class="line">		args = os.Args[<span class="number">1</span>:]</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// initialize the hidden command to be used for shell completion</span></span><br><span class="line">	c.initCompleteCmd(args)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> flags []<span class="type">string</span></span><br><span class="line">	<span class="keyword">if</span> c.TraverseChildren &#123;</span><br><span class="line">		cmd, flags, err = c.Traverse(args)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		cmd, flags, err = c.Find(args)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="comment">// If found parse to a subcommand and then failed, talk about the subcommand</span></span><br><span class="line">		<span class="keyword">if</span> cmd != <span class="literal">nil</span> &#123;</span><br><span class="line">			c = cmd</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> !c.SilenceErrors &#123;</span><br><span class="line">			c.PrintErrln(<span class="string">&quot;Error:&quot;</span>, err.Error())</span><br><span class="line">			c.PrintErrf(<span class="string">&quot;Run &#x27;%v --help&#x27; for usage.\n&quot;</span>, c.CommandPath())</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> c, err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	cmd.commandCalledAs.called = <span class="literal">true</span></span><br><span class="line">	<span class="keyword">if</span> cmd.commandCalledAs.name == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">		cmd.commandCalledAs.name = cmd.Name()</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// We have to pass global context to children command</span></span><br><span class="line">	<span class="comment">// if context is present on the parent command.</span></span><br><span class="line">	<span class="keyword">if</span> cmd.ctx == <span class="literal">nil</span> &#123;</span><br><span class="line">		cmd.ctx = c.ctx</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	err = cmd.execute(flags)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="comment">// Always show help if requested, even if SilenceErrors is in</span></span><br><span class="line">		<span class="comment">// effect</span></span><br><span class="line">		<span class="keyword">if</span> errors.Is(err, flag.ErrHelp) &#123;</span><br><span class="line">			cmd.HelpFunc()(cmd, args)</span><br><span class="line">			<span class="keyword">return</span> cmd, <span class="literal">nil</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// If root command has SilenceErrors flagged,</span></span><br><span class="line">		<span class="comment">// all subcommands should respect it</span></span><br><span class="line">		<span class="keyword">if</span> !cmd.SilenceErrors &amp;&amp; !c.SilenceErrors &#123;</span><br><span class="line">			c.PrintErrln(<span class="string">&quot;Error:&quot;</span>, err.Error())</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// If root command has SilenceUsage flagged,</span></span><br><span class="line">		<span class="comment">// all subcommands should respect it</span></span><br><span class="line">		<span class="keyword">if</span> !cmd.SilenceUsage &amp;&amp; !c.SilenceUsage &#123;</span><br><span class="line">			c.Println(cmd.UsageString())</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> cmd, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Command)</span></span> Find(args []<span class="type">string</span>) (*Command, []<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="keyword">var</span> innerfind <span class="function"><span class="keyword">func</span><span class="params">(*Command, []<span class="type">string</span>)</span></span> (*Command, []<span class="type">string</span>)</span><br><span class="line"></span><br><span class="line">	innerfind = <span class="function"><span class="keyword">func</span><span class="params">(c *Command, innerArgs []<span class="type">string</span>)</span></span> (*Command, []<span class="type">string</span>) &#123;</span><br><span class="line">		argsWOflags := stripFlags(innerArgs, c)</span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">len</span>(argsWOflags) == <span class="number">0</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> c, innerArgs</span><br><span class="line">		&#125;</span><br><span class="line">		nextSubCmd := argsWOflags[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">		cmd := c.findNext(nextSubCmd)</span><br><span class="line">		<span class="keyword">if</span> cmd != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> innerfind(cmd, c.argsMinusFirstX(innerArgs, nextSubCmd))</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> c, innerArgs</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	commandFound, a := innerfind(c, args)</span><br><span class="line">	<span class="keyword">if</span> commandFound.Args == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> commandFound, a, legacyArgs(commandFound, stripFlags(a, commandFound))</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> commandFound, a, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">stripFlags</span><span class="params">(args []<span class="type">string</span>, c *Command)</span></span> []<span class="type">string</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(args) == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> args</span><br><span class="line">	&#125;</span><br><span class="line">	c.mergePersistentFlags()</span><br><span class="line"></span><br><span class="line">	commands := []<span class="type">string</span>&#123;&#125;</span><br><span class="line">	flags := c.Flags()</span><br><span class="line"></span><br><span class="line">Loop:</span><br><span class="line">	<span class="keyword">for</span> <span class="built_in">len</span>(args) &gt; <span class="number">0</span> &#123;</span><br><span class="line">		s := args[<span class="number">0</span>]</span><br><span class="line">		args = args[<span class="number">1</span>:]</span><br><span class="line">		<span class="keyword">switch</span> &#123;</span><br><span class="line">		<span class="keyword">case</span> s == <span class="string">&quot;--&quot;</span>:</span><br><span class="line">			<span class="comment">// &quot;--&quot; terminates the flags</span></span><br><span class="line">			<span class="keyword">break</span> Loop</span><br><span class="line">		<span class="keyword">case</span> strings.HasPrefix(s, <span class="string">&quot;--&quot;</span>) &amp;&amp; !strings.Contains(s, <span class="string">&quot;=&quot;</span>) &amp;&amp; !hasNoOptDefVal(s[<span class="number">2</span>:], flags):</span><br><span class="line">			<span class="comment">// If &#x27;--flag arg&#x27; then</span></span><br><span class="line">			<span class="comment">// delete arg from args.</span></span><br><span class="line">			<span class="keyword">fallthrough</span> <span class="comment">// (do the same as below)</span></span><br><span class="line">		<span class="keyword">case</span> strings.HasPrefix(s, <span class="string">&quot;-&quot;</span>) &amp;&amp; !strings.Contains(s, <span class="string">&quot;=&quot;</span>) &amp;&amp; <span class="built_in">len</span>(s) == <span class="number">2</span> &amp;&amp; !shortHasNoOptDefVal(s[<span class="number">1</span>:], flags):</span><br><span class="line">			<span class="comment">// If &#x27;-f arg&#x27; then</span></span><br><span class="line">			<span class="comment">// delete &#x27;arg&#x27; from args or break the loop if len(args) &lt;= 1.</span></span><br><span class="line">			<span class="keyword">if</span> <span class="built_in">len</span>(args) &lt;= <span class="number">1</span> &#123;</span><br><span class="line">				<span class="keyword">break</span> Loop</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				args = args[<span class="number">1</span>:]</span><br><span class="line">				<span class="keyword">continue</span></span><br><span class="line">			&#125;</span><br><span class="line">		<span class="keyword">case</span> s != <span class="string">&quot;&quot;</span> &amp;&amp; !strings.HasPrefix(s, <span class="string">&quot;-&quot;</span>):</span><br><span class="line">			commands = <span class="built_in">append</span>(commands, s)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> commands</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Command)</span></span> findNext(next <span class="type">string</span>) *Command &#123;</span><br><span class="line">	matches := <span class="built_in">make</span>([]*Command, <span class="number">0</span>)</span><br><span class="line">	<span class="keyword">for</span> _, cmd := <span class="keyword">range</span> c.commands &#123;</span><br><span class="line">		<span class="keyword">if</span> commandNameMatches(cmd.Name(), next) || cmd.HasAlias(next) &#123;</span><br><span class="line">			cmd.commandCalledAs.name = next</span><br><span class="line">			<span class="keyword">return</span> cmd</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> EnablePrefixMatching &amp;&amp; cmd.hasNameOrAliasPrefix(next) &#123;</span><br><span class="line">			matches = <span class="built_in">append</span>(matches, cmd)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(matches) == <span class="number">1</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> matches[<span class="number">0</span>]</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Command)</span></span> execute(a []<span class="type">string</span>) (err <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span> c == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;Called Execute() on a nil Command&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(c.Deprecated) &gt; <span class="number">0</span> &#123;</span><br><span class="line">		c.Printf(<span class="string">&quot;Command %q is deprecated, %s\n&quot;</span>, c.Name(), c.Deprecated)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// initialize help and version flag at the last point possible to allow for user</span></span><br><span class="line">	<span class="comment">// overriding</span></span><br><span class="line">	c.InitDefaultHelpFlag()</span><br><span class="line">	c.InitDefaultVersionFlag()</span><br><span class="line"></span><br><span class="line">	err = c.ParseFlags(a)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> c.FlagErrorFunc()(c, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// If help is called, regardless of other flags, return we want help.</span></span><br><span class="line">	<span class="comment">// Also say we need help if the command isn&#x27;t runnable.</span></span><br><span class="line">	helpVal, err := c.Flags().GetBool(<span class="string">&quot;help&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="comment">// should be impossible to get here as we always declare a help</span></span><br><span class="line">		<span class="comment">// flag in InitDefaultHelpFlag()</span></span><br><span class="line">		c.Println(<span class="string">&quot;\&quot;help\&quot; flag declared as non-bool. Please correct your code&quot;</span>)</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> helpVal &#123;</span><br><span class="line">		<span class="keyword">return</span> flag.ErrHelp</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// for back-compat, only add version flag behavior if version is defined</span></span><br><span class="line">	<span class="keyword">if</span> c.Version != <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">		versionVal, err := c.Flags().GetBool(<span class="string">&quot;version&quot;</span>)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			c.Println(<span class="string">&quot;\&quot;version\&quot; flag declared as non-bool. Please correct your code&quot;</span>)</span><br><span class="line">			<span class="keyword">return</span> err</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> versionVal &#123;</span><br><span class="line">			err := tmpl(c.OutOrStdout(), c.VersionTemplate(), c)</span><br><span class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">				c.Println(err)</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> err</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> !c.Runnable() &#123;</span><br><span class="line">		<span class="keyword">return</span> flag.ErrHelp</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	c.preRun()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">defer</span> c.postRun()</span><br><span class="line"></span><br><span class="line">	argWoFlags := c.Flags().Args()</span><br><span class="line">	<span class="keyword">if</span> c.DisableFlagParsing &#123;</span><br><span class="line">		argWoFlags = a</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err := c.ValidateArgs(argWoFlags); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> p := c; p != <span class="literal">nil</span>; p = p.Parent() &#123;</span><br><span class="line">		<span class="keyword">if</span> p.PersistentPreRunE != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> err := p.PersistentPreRunE(c, argWoFlags); err != <span class="literal">nil</span> &#123;</span><br><span class="line">				<span class="keyword">return</span> err</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> p.PersistentPreRun != <span class="literal">nil</span> &#123;</span><br><span class="line">			p.PersistentPreRun(c, argWoFlags)</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> c.PreRunE != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> err := c.PreRunE(c, argWoFlags); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> err</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> c.PreRun != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.PreRun(c, argWoFlags)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err := c.ValidateRequiredFlags(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> err := c.ValidateFlagGroups(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> c.RunE != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> err := c.RunE(c, argWoFlags); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> err</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		c.Run(c, argWoFlags)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> c.PostRunE != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> err := c.PostRunE(c, argWoFlags); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> err</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> c.PostRun != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.PostRun(c, argWoFlags)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> p := c; p != <span class="literal">nil</span>; p = p.Parent() &#123;</span><br><span class="line">		<span class="keyword">if</span> p.PersistentPostRunE != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> err := p.PersistentPostRunE(c, argWoFlags); err != <span class="literal">nil</span> &#123;</span><br><span class="line">				<span class="keyword">return</span> err</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> p.PersistentPostRun != <span class="literal">nil</span> &#123;</span><br><span class="line">			p.PersistentPostRun(c, argWoFlags)</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="钩子函数"><a href="#钩子函数" class="headerlink" title="钩子函数"></a>钩子函数</h2><p>initializers： 命令执行前初始化<br>finalizers： 命令执行后析构</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> initializers []<span class="function"><span class="keyword">func</span><span class="params">()</span></span></span><br><span class="line"><span class="keyword">var</span> finalizers []<span class="function"><span class="keyword">func</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// OnInitialize sets the passed functions to be run when each command&#x27;s</span></span><br><span class="line"><span class="comment">// Execute method is called.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">OnInitialize</span><span class="params">(y ...<span class="keyword">func</span>()</span></span>) &#123;</span><br><span class="line">	initializers = <span class="built_in">append</span>(initializers, y...)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// OnFinalize sets the passed functions to be run when each command&#x27;s</span></span><br><span class="line"><span class="comment">// Execute method is terminated.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">OnFinalize</span><span class="params">(y ...<span class="keyword">func</span>()</span></span>) &#123;</span><br><span class="line">	finalizers = <span class="built_in">append</span>(finalizers, y...)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Command)</span></span> preRun() &#123;</span><br><span class="line">	<span class="keyword">for</span> _, x := <span class="keyword">range</span> initializers &#123;</span><br><span class="line">		x()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Command)</span></span> postRun() &#123;</span><br><span class="line">	<span class="keyword">for</span> _, x := <span class="keyword">range</span> finalizers &#123;</span><br><span class="line">		x()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


        
            <div id="toc-article">
                
  <div class="widget-wrap" id="toc-wrap">
    <h3 class="widget-title"><i class="fa fa-toc"></i> 文章目录</h3>
    <div class="widget">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#command-%E7%BB%93%E6%9E%84"><span class="toc-text">command 结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AddCommand-%E6%96%B9%E6%B3%95"><span class="toc-text">AddCommand 方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Execute-%E6%96%B9%E6%B3%95"><span class="toc-text">Execute 方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%92%A9%E5%AD%90%E5%87%BD%E6%95%B0"><span class="toc-text">钩子函数</span></a></li></ol>
    </div>
  </div>


            </div>
        
        
          <blockquote id="copyright">
              <p>原文链接: <a href="https://weixiaodong.github.io/2023/03/10/go-cobra包源码阅读/">https://weixiaodong.github.io/2023/03/10/go-cobra包源码阅读/</a></p>
              <p>版权声明: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          
    <div class="article-reward">
        <a id="reward-btn" href="javascript:;">打赏</a>
        <div id="reward-content">
            <h6 class="reward-tit">“感谢你的支持，我会继续努力！”</h6>
            <div>
                <div class="reward-code">
                    <img class="type-code" src="/css/images/wechat.jpg">
                    <img class="er-code" src="/css/images/wechat-pay.png">
                </div>
                <div class="reward-code">
                    <img class="type-code" src="/css/images/alipay.jpg">
                    <img class="er-code" src="/css/images/alipay-pay.png">
                </div>
            </div>
            <p class="reward-desc">扫码打赏，感谢支持</p>
        </div>
    </div>


          
          
    <div class="social-share">
      <span>分享到:</span>
    </div>



        </div>
      
      
        
<nav id="article-nav">
  
    <a href="/2023/03/10/go-%E6%AF%8F%E6%97%A5%E4%B8%80%E5%BA%93%E4%B9%8B-cobra-cli%E4%BD%BF%E7%94%A8/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">older</strong>
      <div class="article-nav-title">
        
          go-每日一库之-cobra-cli使用
        
      </div>
    </a>
  
  
    <a href="/2023/03/14/go-%E6%AF%8F%E6%97%A5%E4%B8%80%E5%BA%93%E4%B9%8B-grpc%E4%BD%BF%E7%94%A8/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">newer</strong>
      <div class="article-nav-title">
        
          go-每日一库之-grpc使用
        
      </div>
    </a>
  
</nav>

      
      
        


  <section id="comments" class="vcomment"></section>







      
    </footer>
  </div>
</article>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-posts"></i> 最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/03/17/grpc%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/">grpc负载均衡</a>
          </li>
        
          <li>
            <a href="/2023/03/17/etcd%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/">etcd实现服务注册与发现</a>
          </li>
        
          <li>
            <a href="/2023/03/16/go-%E6%AF%8F%E6%97%A5%E4%B8%80%E5%BA%93%E4%B9%8B-etcd%E4%BD%BF%E7%94%A8/">go-每日一库之-etcd使用</a>
          </li>
        
          <li>
            <a href="/2023/03/15/http2%E5%8D%8F%E8%AE%AE%E8%AF%A6%E8%A7%A3/">http2协议详解</a>
          </li>
        
          <li>
            <a href="/2023/03/14/go-%E6%AF%8F%E6%97%A5%E4%B8%80%E5%BA%93%E4%B9%8B-grpc%E4%BD%BF%E7%94%A8/">go-每日一库之-grpc使用</a>
          </li>
        
      </ul>
    </div>
  </div>


  
    
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-archive"></i> 归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/">2023年</a><span class="archive-list-count">10</span></li></ul>
    </div>
  </div>


  
    

  
    

  
</aside>
        
      </div>
      <a id="totop" href="#top"></a>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <p>
        <a href="/sitemap.xml">网站地图</a>
        <span> | </span><a href="/atom.xml">订阅本站</a>
        <span> | </span><a href="/about/">联系博主</a>
      </p>
      
        <p>
          <i class="fa fa-visitors"></i>
          <i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>
          ，
          <i class="fa fa-views"></i>
          <i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>
        </p>
      
      <p>
        <span>Copyright &copy; 2023 卫小栋.</span>
        <span>Theme by <a href="https://github.com/chaooo/hexo-theme-BlueLake/" target="_blank">BlueLake.</a></span>
        <span>Powered by <a href="https://hexo.io/" target="_blank">Hexo.</a></span>
      </p>
    </div>
  </div>
</footer>

    </div>
  </div>
  
<script src="/js/jquery-3.4.1.min.js"></script>


<script src="/js/search.json.js"></script>


  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>






  
<script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  
    
<script src="/localshare/js/social-share.js"></script>

    
<script src="/localshare/js/qrcode.js"></script>

  
  



  

  

  
    
<script src="https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js"></script>

    <script>
      var GUEST_INFO = ['nick','mail','link'];
      var guest_info = 'nick,mail,link'.split(',').filter(function(item){
          return GUEST_INFO.indexOf(item) > -1
      });
      var notify = 'false' == true;
      var verify = 'false' == true;
      new Valine({
          el: '.vcomment',
          notify: notify,
          verify: verify,
          appId: "Ao8Phc6VLirvJSnGnlUY8gng-9Nh9j0Va",
          appKey: "uoKVJAn0RJKvNZTi3f2wPRla",
          placeholder: "Just go go",
          pageSize:'10',
          avatar:'mm',
          lang:'zh-cn'
      });
    </script>
  

  

  

  

  

  
  





</body>
</html>