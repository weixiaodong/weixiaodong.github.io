<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>go-每日一库之-cobra | 学习记录</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  
  
    <link rel="alternate" href="/atom.xml" title="学习记录" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
    
<link rel="stylesheet" href="/localshare/css/share.css">

  
  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">学习记录</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/."><i class="fa fa-home"></i> 首页</a>
        
          <a class="main-nav-link" href="/archives/"><i class="fa fa-archive"></i> 归档</a>
        
          <a class="main-nav-link" href="/about/"><i class="fa fa-user"></i> 关于</a>
        
      </nav>
    </div>
    <div id="search-form">
      <div id="result-mask" class="hide"></div>
      <label><input id="search-key" type="text" autocomplete="off" placeholder="搜索"></label>
      <div id="result-wrap" class="hide">
        <div id="search-result"></div>
      </div>
      <div class="hide">
        <template id="search-tpl">
          <div class="item">
            <a href="/{path}" title="{title}">
              <div class="title">{title}</div>
              <div class="time">{date}</div>
              <div class="tags">{tags}</div>
            </a>
          </div>
        </template>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-go-每日一库之-cobra" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      go-每日一库之-cobra
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2023-03-09T01:18:20.000Z" itemprop="datePublished">2023年03月09日</time>
</span>
      
      
        <span class="article-views">
  <i class="fa fa-views"></i>
  <i id="busuanzi_container_page_pv">
      <i id="busuanzi_value_page_pv"></i>
  </i>
</span>

      
      
<a href="/2023/03/09/go-%E6%AF%8F%E6%97%A5%E4%B8%80%E5%BA%93%E4%B9%8B-cobra/#comments" class="article-comment-link">
  
    
      <span class="post-comments-count valine-comment-count" data-xid="/2023/03/09/go-%E6%AF%8F%E6%97%A5%E4%B8%80%E5%BA%93%E4%B9%8B-cobra/" itemprop="commentCount"></span>
    
    
    
    
    
  
  <i class="fa fa-commt"></i>
  留言
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h2><p>cobra 是一个用于创建命令行工具的库（框架），可以创建出类似git或者go一样的工具，比如我们平时熟悉的git clone&#x2F;pull、 go get&#x2F;install 等操作。kubernetes 工具中就使用了cobra。</p>
<span id="more"></span>

<p>上述这些命令行工具的–help&#x2F;-h既好看又好理解，开始时我也会好奇这些工具是如何实现多级子命令支持的？ cobra的目标即使提供快速构建出此类工具的能力（cobra是框架，具体的业务逻辑当然还是要自己写）。 例如可以为我们app或者系统工具的bin文件添加–config来启动服务、添加–version来查看版本号。相比起标准库里的flag包，cobra强大了很多。</p>
<p>官网列出了cobra的一大堆优点:</p>
<ol>
<li>易用的subcommand模式（即嵌套命令或子命令）</li>
<li>强大的flags支持（参考标准库flagSet）</li>
<li>支持global、local、、cascading级别的flag设置</li>
<li>错误时的智能提示</li>
<li>自动生成的、美观的help信息，并默认支持–help或-h打印的help信息</li>
<li>提供命令自动补全功能（bash、 zsh、 fish、 powershell环境）</li>
<li>提供命令man page自动生成功能</li>
<li>有兄弟项目viper可以快捷的实现配置文件解析和flag绑定（暂不建议直接使用，viper包装了一些配置文件解析的细节，应当在熟悉cobra之后再单独了解）</li>
</ol>
<h2 id="本文的核心目的为：-通过手写一个示例来迅速入门cobra"><a href="#本文的核心目的为：-通过手写一个示例来迅速入门cobra" class="headerlink" title="本文的核心目的为： 通过手写一个示例来迅速入门cobra"></a>本文的核心目的为： 通过手写一个示例来迅速入门cobra</h2><p>先来简单看下cobra框架中主要概念:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kebectl get pod|service [podName|serviceName] -n &lt;namespace&gt;</span><br></pre></td></tr></table></figure>

<p>以上述kubectl get为例，cobra将kubectl称为rootcmd（即根命令）， get称作rootcmd的subcmd， pod|service则是get的subcmd，podName、serviceName是pod&#x2F;service的args， -n&#x2F;–namespace称作flag。同时我们还观察到-n 这个flag其实写在任意-个cmd之后都会正常生效，这说明这是一个global flag，global flag对于rootcmd及所有子命令生效。<br>此外，当为cmd指定了一个与subcmd同名的args时，subcmd优先生效。</p>
<h2 id="一、-使用cobra建议的项目目录结构"><a href="#一、-使用cobra建议的项目目录结构" class="headerlink" title="一、 使用cobra建议的项目目录结构"></a>一、 使用cobra建议的项目目录结构</h2><p>cobra文档告诉我们，使用cobra时最好遵循如下的项目目录设置（即： 把命令行定义相关的部分单独写在一个名为cmd的包内）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">▾ appName/</span><br><span class="line">  ▾ cmd/</span><br><span class="line">      add.go</span><br><span class="line">      your.go</span><br><span class="line">      commands.go</span><br><span class="line">      here.go</span><br><span class="line">    main.go</span><br></pre></td></tr></table></figure>

<p>使用cobra的项目，其程序入口main.go一般极为简洁（相应的业务逻辑都在cmd里调用或实现）:</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;&#123;pathToYourApp&#125;/cmd&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	cmd.Execute()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="使用cobra库"><a href="#使用cobra库" class="headerlink" title="使用cobra库"></a>使用cobra库</h2><p>要手动写cobra代码，您需要创建一个裸main.go文件和一个rootCmd文件，你可以选择提供您认为合适的其他命令。</p>
<h2 id="创建rootCmd文件"><a href="#创建rootCmd文件" class="headerlink" title="创建rootCmd文件"></a>创建rootCmd文件</h2><p>cobra不需要任何特殊的构造函数，只需创建您的命令。</p>
<p>理想情况下，您将它放在cmd&#x2F;root.go中：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> rootCmd = &amp;cobra.Command&#123;</span><br><span class="line">  Use:   <span class="string">&quot;hugo&quot;</span>,</span><br><span class="line">  Short: <span class="string">&quot;Hugo is a very fast static site generator&quot;</span>,</span><br><span class="line">  Long: <span class="string">`A Fast and Flexible Static Site Generator built with</span></span><br><span class="line"><span class="string">                love by spf13 and friends in Go.</span></span><br><span class="line"><span class="string">                Complete documentation is available at https://gohugo.io/documentation/`</span>,</span><br><span class="line">  Run: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// Do Stuff Here</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Execute</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">if</span> err := rootCmd.Execute(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Fprintln(os.Stderr, err)</span><br><span class="line">    os.Exit(<span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>您还将在 init() 函数中定义标志和处理配置。</p>
<p>例如cmd&#x2F;root.go：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cmd</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;os&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="string">&quot;github.com/spf13/cobra&quot;</span></span><br><span class="line">  <span class="string">&quot;github.com/spf13/viper&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">  <span class="comment">// Used for flags.</span></span><br><span class="line">  cfgFile     <span class="type">string</span></span><br><span class="line">  userLicense <span class="type">string</span></span><br><span class="line"></span><br><span class="line">  rootCmd = &amp;cobra.Command&#123;</span><br><span class="line">    Use:   <span class="string">&quot;cobra-cli&quot;</span>,</span><br><span class="line">    Short: <span class="string">&quot;A generator for Cobra based Applications&quot;</span>,</span><br><span class="line">    Long: <span class="string">`Cobra is a CLI library for Go that empowers applications.</span></span><br><span class="line"><span class="string">This application is a tool to generate the needed files</span></span><br><span class="line"><span class="string">to quickly create a Cobra application.`</span>,</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Execute executes the root command.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Execute</span><span class="params">()</span></span> <span class="type">error</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> rootCmd.Execute()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">  cobra.OnInitialize(initConfig)</span><br><span class="line"></span><br><span class="line">  rootCmd.PersistentFlags().StringVar(&amp;cfgFile, <span class="string">&quot;config&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;config file (default is $HOME/.cobra.yaml)&quot;</span>)</span><br><span class="line">  rootCmd.PersistentFlags().StringP(<span class="string">&quot;author&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;YOUR NAME&quot;</span>, <span class="string">&quot;author name for copyright attribution&quot;</span>)</span><br><span class="line">  rootCmd.PersistentFlags().StringVarP(&amp;userLicense, <span class="string">&quot;license&quot;</span>, <span class="string">&quot;l&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;name of license for the project&quot;</span>)</span><br><span class="line">  rootCmd.PersistentFlags().Bool(<span class="string">&quot;viper&quot;</span>, <span class="literal">true</span>, <span class="string">&quot;use Viper for configuration&quot;</span>)</span><br><span class="line">  viper.BindPFlag(<span class="string">&quot;author&quot;</span>, rootCmd.PersistentFlags().Lookup(<span class="string">&quot;author&quot;</span>))</span><br><span class="line">  viper.BindPFlag(<span class="string">&quot;useViper&quot;</span>, rootCmd.PersistentFlags().Lookup(<span class="string">&quot;viper&quot;</span>))</span><br><span class="line">  viper.SetDefault(<span class="string">&quot;author&quot;</span>, <span class="string">&quot;NAME HERE &lt;EMAIL ADDRESS&gt;&quot;</span>)</span><br><span class="line">  viper.SetDefault(<span class="string">&quot;license&quot;</span>, <span class="string">&quot;apache&quot;</span>)</span><br><span class="line"></span><br><span class="line">  rootCmd.AddCommand(addCmd)</span><br><span class="line">  rootCmd.AddCommand(initCmd)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initConfig</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">if</span> cfgFile != <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">    <span class="comment">// Use config file from the flag.</span></span><br><span class="line">    viper.SetConfigFile(cfgFile)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// Find home directory.</span></span><br><span class="line">    home, err := os.UserHomeDir()</span><br><span class="line">    cobra.CheckErr(err)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Search config in home directory with name &quot;.cobra&quot; (without extension).</span></span><br><span class="line">    viper.AddConfigPath(home)</span><br><span class="line">    viper.SetConfigType(<span class="string">&quot;yaml&quot;</span>)</span><br><span class="line">    viper.SetConfigName(<span class="string">&quot;.cobra&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  viper.AutomaticEnv()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> err := viper.ReadInConfig(); err == <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Using config file:&quot;</span>, viper.ConfigFileUsed())</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="创建你的-main-go"><a href="#创建你的-main-go" class="headerlink" title="创建你的 main.go"></a>创建你的 main.go</h2><p>使用 root 命令，您需要让主函数执行它。为清楚起见，应在根目录上运行 Execute，尽管它可以在任何命令上调用。</p>
<p>在 Cobra 应用程序中，通常 main.go 文件非常简单。它有一个目的：调用 Cobra。</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;&#123;pathToYourApp&#125;/cmd&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  cmd.Execute()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="创建附加命令"><a href="#创建附加命令" class="headerlink" title="创建附加命令"></a>创建附加命令</h2><p>可以定义其他命令，通常每个命令在 cmd&#x2F; 目录中都有自己的文件。</p>
<p>如果你想创建一个版本命令，你可以创建 cmd&#x2F;version.go 并用以下内容填充它：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cmd</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="string">&quot;github.com/spf13/cobra&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">  rootCmd.AddCommand(versionCmd)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> versionCmd = &amp;cobra.Command&#123;</span><br><span class="line">  Use:   <span class="string">&quot;version&quot;</span>,</span><br><span class="line">  Short: <span class="string">&quot;Print the version number of Hugo&quot;</span>,</span><br><span class="line">  Long:  <span class="string">`All software has versions. This is Hugo&#x27;s`</span>,</span><br><span class="line">  Run: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Hugo Static Site Generator v0.9 -- HEAD&quot;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="返回和处理错误"><a href="#返回和处理错误" class="headerlink" title="返回和处理错误"></a>返回和处理错误</h2><p>如果您希望向命令的调用者返回错误，RunE可以使用。</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cmd</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="string">&quot;github.com/spf13/cobra&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">  rootCmd.AddCommand(tryCmd)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> tryCmd = &amp;cobra.Command&#123;</span><br><span class="line">  Use:   <span class="string">&quot;try&quot;</span>,</span><br><span class="line">  Short: <span class="string">&quot;Try and possibly fail at something&quot;</span>,</span><br><span class="line">  RunE: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="type">string</span>)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> err := someFunc(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后可以在执行函数调用时捕获错误。</p>
<h2 id="使用标志"><a href="#使用标志" class="headerlink" title="使用标志"></a>使用标志</h2><p>标志提供修饰符来控制操作命令的操作方式。</p>
<h3 id="为命令分配标志"><a href="#为命令分配标志" class="headerlink" title="为命令分配标志"></a>为命令分配标志</h3><p>由于标志是在不同的位置定义和使用的，因此我们需要在外部定义一个具有正确范围的变量来分配要使用的标志。</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Verbose <span class="type">bool</span></span><br><span class="line"><span class="keyword">var</span> Source <span class="type">string</span></span><br></pre></td></tr></table></figure>

<h2 id="有两种不同的方法来分配标志。"><a href="#有两种不同的方法来分配标志。" class="headerlink" title="有两种不同的方法来分配标志。"></a>有两种不同的方法来分配标志。</h2><h3 id="持久标志"><a href="#持久标志" class="headerlink" title="持久标志"></a>持久标志</h3><p>标志可以是“持久的”，这意味着该标志将可用于分配给它的命令以及该命令下的每个命令。对于全局标志，将标志分配为根上的持久标志。</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rootCmd.PersistentFlags().BoolVarP(&amp;Verbose, <span class="string">&quot;verbose&quot;</span>, <span class="string">&quot;v&quot;</span>, <span class="literal">false</span>, <span class="string">&quot;verbose output&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="本地标志"><a href="#本地标志" class="headerlink" title="本地标志"></a>本地标志</h3><p>也可以在本地分配标志，这将仅适用于该特定命令。</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">localCmd.Flags().StringVarP(&amp;Source, <span class="string">&quot;source&quot;</span>, <span class="string">&quot;s&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;Source directory to read from&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="父命令的本地标志"><a href="#父命令的本地标志" class="headerlink" title="父命令的本地标志"></a>父命令的本地标志</h3><p>默认情况下，Cobra 仅解析目标命令上的本地标志，而忽略父命令上的任何本地标志。通过启用Command.TraverseChildren，Cobra 将在执行目标命令之前解析每个命令的本地标志。</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">command := cobra.Command&#123;</span><br><span class="line">  Use: <span class="string">&quot;print [OPTIONS] [COMMANDS]&quot;</span>,</span><br><span class="line">  TraverseChildren: <span class="literal">true</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用配置绑定标志"><a href="#使用配置绑定标志" class="headerlink" title="使用配置绑定标志"></a>使用配置绑定标志</h3><p>你也可以用viper绑定你的标志：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> author <span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">  rootCmd.PersistentFlags().StringVar(&amp;author, <span class="string">&quot;author&quot;</span>, <span class="string">&quot;YOUR NAME&quot;</span>, <span class="string">&quot;Author name for copyright attribution&quot;</span>)</span><br><span class="line">  viper.BindPFlag(<span class="string">&quot;author&quot;</span>, rootCmd.PersistentFlags().Lookup(<span class="string">&quot;author&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在此示例中，持久标志author与viper绑定. 注意：当用户提供标志–author时，变量author不会设置为配置中的值。</p>
<h3 id="必需的标志"><a href="#必需的标志" class="headerlink" title="必需的标志"></a>必需的标志</h3><p>默认情况下，标志是可选的。相反，如果您希望您的命令在未设置标志时报告错误，请将其标记为必需：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rootCmd.Flags().StringVarP(&amp;Region, <span class="string">&quot;region&quot;</span>, <span class="string">&quot;r&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;AWS region (required)&quot;</span>)</span><br><span class="line">rootCmd.MarkFlagRequired(<span class="string">&quot;region&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>或者，对于持久性标志：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rootCmd.PersistentFlags().StringVarP(&amp;Region, <span class="string">&quot;region&quot;</span>, <span class="string">&quot;r&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;AWS region (required)&quot;</span>)</span><br><span class="line">rootCmd.MarkPersistentFlagRequired(<span class="string">&quot;region&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="标志组"><a href="#标志组" class="headerlink" title="标志组"></a>标志组</h3><p>如果你有不同的标志必须一起提供（例如，如果他们提供标志，他们也–username必须提供标志）那么 Cobra 可以强制执行该要求：–password</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rootCmd.Flags().StringVarP(&amp;u, <span class="string">&quot;username&quot;</span>, <span class="string">&quot;u&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;Username (required if password is set)&quot;</span>)</span><br><span class="line">rootCmd.Flags().StringVarP(&amp;pw, <span class="string">&quot;password&quot;</span>, <span class="string">&quot;p&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;Password (required if username is set)&quot;</span>)</span><br><span class="line">rootCmd.MarkFlagsRequiredTogether(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;password&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>如果不同的标志代表相互排斥的选项，例如将输出格式指定为其中之一–json或–yaml但绝不是两者，您还可以防止一起提供不同的标志：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rootCmd.Flags().BoolVar(&amp;ofJson, <span class="string">&quot;json&quot;</span>, <span class="literal">false</span>, <span class="string">&quot;Output in JSON&quot;</span>)</span><br><span class="line">rootCmd.Flags().BoolVar(&amp;ofYaml, <span class="string">&quot;yaml&quot;</span>, <span class="literal">false</span>, <span class="string">&quot;Output in YAML&quot;</span>)</span><br><span class="line">rootCmd.MarkFlagsMutuallyExclusive(<span class="string">&quot;json&quot;</span>, <span class="string">&quot;yaml&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>在这两种情况下：</p>
<p>本地和持久标志都可以使用<br>注意：该组仅对定义了每个标志的命令强制执行<br>一个标志可能出现在多个组中<br>一个组可以包含任意数量的标志</p>
<h3 id="位置和自定义参数"><a href="#位置和自定义参数" class="headerlink" title="位置和自定义参数"></a>位置和自定义参数</h3><p>可以使用 的Args字段指定位置参数的验证Command。内置了以下验证器：</p>
<p>参数数量：</p>
<ul>
<li>NoArgs- 如果有任何位置参数则报告错误。</li>
<li>ArbitraryArgs- 接受任意数量的参数。</li>
<li>MinimumNArgs(int)- 如果提供的位置参数少于 N 个，则报告错误。</li>
<li>MaximumNArgs(int)- 如果提供了超过 N 个位置参数，则报告错误。</li>
<li>ExactArgs(int)- 如果不完全有 N 个位置参数，则报告错误。</li>
<li>RangeArgs(min, max)- 如果 args 的数量不在 和 之间，则报告min错误max。</li>
</ul>
<p>论证内容：</p>
<p>  OnlyValidArgsValidArgs- 如果在字段中没有指定任何位置参数，则报告错误Command，可以选择将其设置为位置参数的有效值列表。<br>  如果Args是 undefined 或nil，则默认为ArbitraryArgs.</p>
<p>  此外，MatchAll(pargs …PositionalArgs)可以将现有检查与任意其他检查相结合。ValidArgs例如，如果你想在不正好有 N 个位置参数或者有任何位置参数不在的字段中时报错，Command你可以调用MatchAlland ExactArgs，OnlyValidArgs如下所示：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> cmd = &amp;cobra.Command&#123;</span><br><span class="line">  Short: <span class="string">&quot;hello&quot;</span>,</span><br><span class="line">  Args: cobra.MatchAll(cobra.ExactArgs(<span class="number">2</span>), cobra.OnlyValidArgs),</span><br><span class="line">  Run: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Hello, World!&quot;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以设置任何满足func(cmd *cobra.Command, args []string) error. 例如:</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> cmd = &amp;cobra.Command&#123;</span><br><span class="line">  Short: <span class="string">&quot;hello&quot;</span>,</span><br><span class="line">  Args: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="type">string</span>)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">    <span class="comment">// Optionally run one of the validators provided by cobra</span></span><br><span class="line">    <span class="keyword">if</span> err := cobra.MinimumNArgs(<span class="number">1</span>)(cmd, args); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Run the custom validation logic</span></span><br><span class="line">    <span class="keyword">if</span> myapp.IsValidColor(args[<span class="number">0</span>]) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;invalid color specified: %s&quot;</span>, args[<span class="number">0</span>])</span><br><span class="line">  &#125;,</span><br><span class="line">  Run: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Hello, World!&quot;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><p>在下面的示例中，我们定义了三个命令。两个在顶层，一个 (cmdTimes) 是顶级命令之一的子级。在这种情况下，root 是不可执行的，这意味着需要一个子命令。这是通过不为“rootCmd”提供“运行”来实现的。</p>
<p>我们只为单个命令定义了一个标志。</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;strings&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="string">&quot;github.com/spf13/cobra&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> echoTimes <span class="type">int</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> cmdPrint = &amp;cobra.Command&#123;</span><br><span class="line">    Use:   <span class="string">&quot;print [string to print]&quot;</span>,</span><br><span class="line">    Short: <span class="string">&quot;Print anything to the screen&quot;</span>,</span><br><span class="line">    Long: <span class="string">`print is for printing anything back to the screen.</span></span><br><span class="line"><span class="string">For many years people have printed back to the screen.`</span>,</span><br><span class="line">    Args: cobra.MinimumNArgs(<span class="number">1</span>),</span><br><span class="line">    Run: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">&quot;Print: &quot;</span> + strings.Join(args, <span class="string">&quot; &quot;</span>))</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> cmdEcho = &amp;cobra.Command&#123;</span><br><span class="line">    Use:   <span class="string">&quot;echo [string to echo]&quot;</span>,</span><br><span class="line">    Short: <span class="string">&quot;Echo anything to the screen&quot;</span>,</span><br><span class="line">    Long: <span class="string">`echo is for echoing anything back.</span></span><br><span class="line"><span class="string">Echo works a lot like print, except it has a child command.`</span>,</span><br><span class="line">    Args: cobra.MinimumNArgs(<span class="number">1</span>),</span><br><span class="line">    Run: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">&quot;Echo: &quot;</span> + strings.Join(args, <span class="string">&quot; &quot;</span>))</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> cmdTimes = &amp;cobra.Command&#123;</span><br><span class="line">    Use:   <span class="string">&quot;times [string to echo]&quot;</span>,</span><br><span class="line">    Short: <span class="string">&quot;Echo anything to the screen more times&quot;</span>,</span><br><span class="line">    Long: <span class="string">`echo things multiple times back to the user by providing</span></span><br><span class="line"><span class="string">a count and a string.`</span>,</span><br><span class="line">    Args: cobra.MinimumNArgs(<span class="number">1</span>),</span><br><span class="line">    Run: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">      <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; echoTimes; i++ &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;Echo: &quot;</span> + strings.Join(args, <span class="string">&quot; &quot;</span>))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  cmdTimes.Flags().IntVarP(&amp;echoTimes, <span class="string">&quot;times&quot;</span>, <span class="string">&quot;t&quot;</span>, <span class="number">1</span>, <span class="string">&quot;times to echo the input&quot;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> rootCmd = &amp;cobra.Command&#123;Use: <span class="string">&quot;app&quot;</span>&#125;</span><br><span class="line">  rootCmd.AddCommand(cmdPrint, cmdEcho)</span><br><span class="line">  cmdEcho.AddCommand(cmdTimes)</span><br><span class="line">  rootCmd.Execute()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="帮助命令"><a href="#帮助命令" class="headerlink" title="帮助命令"></a>帮助命令</h2><p>当您有子命令时，Cobra 会自动向您的应用程序添加帮助命令。这将在用户运行“应用程序帮助”时调用。此外，帮助还将支持所有其他命令作为输入。比如说，你有一个名为“create”的命令，没有任何额外的配置；Cobra 将在调用“app help create”时工作。每个命令都会自动添加“–help”标志。</p>
<h3 id="定义你自己的帮助"><a href="#定义你自己的帮助" class="headerlink" title="定义你自己的帮助"></a>定义你自己的帮助</h3><p>您可以为默认命令提供您自己的帮助命令或您自己的模板，以与以下功能一起使用：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cmd.SetHelpCommand(cmd *Command)</span><br><span class="line">cmd.SetHelpFunc(f <span class="function"><span class="keyword">func</span><span class="params">(*Command, []<span class="type">string</span>)</span></span>)</span><br><span class="line">cmd.SetHelpTemplate(s <span class="type">string</span>)</span><br></pre></td></tr></table></figure>

<h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><p>当用户提供无效标志或无效命令时，Cobra 通过向用户显示“用法”来响应。<br>定义自己的用法</p>
<p>您可以提供自己的使用函数或模板供 Cobra 使用。像帮助一样，函数和模板可以通过公共方法覆盖：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cmd.SetUsageFunc(f <span class="function"><span class="keyword">func</span><span class="params">(*Command)</span></span> <span class="type">error</span>)</span><br><span class="line">cmd.SetUsageTemplate(s <span class="type">string</span>)</span><br></pre></td></tr></table></figure>

<h2 id="版本标志"><a href="#版本标志" class="headerlink" title="版本标志"></a>版本标志</h2><p>如果在根命令上设置了 Version 字段，Cobra 会添加一个顶级“–version”标志。使用“–version”标志运行应用程序将使用版本模板将版本打印到标准输出。可以使用该 cmd.SetVersionTemplate(s string)功能自定义模板。</p>
<h2 id="PreRun-和-PostRun-挂钩"><a href="#PreRun-和-PostRun-挂钩" class="headerlink" title="PreRun 和 PostRun 挂钩"></a>PreRun 和 PostRun 挂钩</h2><p>可以在Run命令的主要功能之前或之后运行功能. PersistentPreRun和PreRun函数将在run之前执行。PersistentPostRun 和 PostRun 将在run之后执行。 Persistent*Run将由孩子继承。 函数按以下顺序运行:</p>
<ol>
<li>PersistentPreRun</li>
<li>PreRun</li>
<li>Run</li>
<li>PostRun</li>
<li>PersistentPostRun</li>
</ol>
<p>下面是使用所有这些功能的两个命令的示例。执行子命令时，它将运行根命令PersistentPreRun但不运行根命令PersistentPostRun：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="string">&quot;github.com/spf13/cobra&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> rootCmd = &amp;cobra.Command&#123;</span><br><span class="line">    Use:   <span class="string">&quot;root [sub]&quot;</span>,</span><br><span class="line">    Short: <span class="string">&quot;My root command&quot;</span>,</span><br><span class="line">    PersistentPreRun: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">      fmt.Printf(<span class="string">&quot;Inside rootCmd PersistentPreRun with args: %v\n&quot;</span>, args)</span><br><span class="line">    &#125;,</span><br><span class="line">    PreRun: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">      fmt.Printf(<span class="string">&quot;Inside rootCmd PreRun with args: %v\n&quot;</span>, args)</span><br><span class="line">    &#125;,</span><br><span class="line">    Run: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">      fmt.Printf(<span class="string">&quot;Inside rootCmd Run with args: %v\n&quot;</span>, args)</span><br><span class="line">    &#125;,</span><br><span class="line">    PostRun: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">      fmt.Printf(<span class="string">&quot;Inside rootCmd PostRun with args: %v\n&quot;</span>, args)</span><br><span class="line">    &#125;,</span><br><span class="line">    PersistentPostRun: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">      fmt.Printf(<span class="string">&quot;Inside rootCmd PersistentPostRun with args: %v\n&quot;</span>, args)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> subCmd = &amp;cobra.Command&#123;</span><br><span class="line">    Use:   <span class="string">&quot;sub [no options!]&quot;</span>,</span><br><span class="line">    Short: <span class="string">&quot;My subcommand&quot;</span>,</span><br><span class="line">    PreRun: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">      fmt.Printf(<span class="string">&quot;Inside subCmd PreRun with args: %v\n&quot;</span>, args)</span><br><span class="line">    &#125;,</span><br><span class="line">    Run: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">      fmt.Printf(<span class="string">&quot;Inside subCmd Run with args: %v\n&quot;</span>, args)</span><br><span class="line">    &#125;,</span><br><span class="line">    PostRun: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">      fmt.Printf(<span class="string">&quot;Inside subCmd PostRun with args: %v\n&quot;</span>, args)</span><br><span class="line">    &#125;,</span><br><span class="line">    PersistentPostRun: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">      fmt.Printf(<span class="string">&quot;Inside subCmd PersistentPostRun with args: %v\n&quot;</span>, args)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  rootCmd.AddCommand(subCmd)</span><br><span class="line"></span><br><span class="line">  rootCmd.SetArgs([]<span class="type">string</span>&#123;<span class="string">&quot;&quot;</span>&#125;)</span><br><span class="line">  rootCmd.Execute()</span><br><span class="line">  fmt.Println()</span><br><span class="line">  rootCmd.SetArgs([]<span class="type">string</span>&#123;<span class="string">&quot;sub&quot;</span>, <span class="string">&quot;arg1&quot;</span>, <span class="string">&quot;arg2&quot;</span>&#125;)</span><br><span class="line">  rootCmd.Execute()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="发生“未知命令”时的建议"><a href="#发生“未知命令”时的建议" class="headerlink" title="发生“未知命令”时的建议"></a>发生“未知命令”时的建议</h2><p>当“未知命令”错误发生时，Cobra 将打印自动建议。git这允许 Cobra在发生拼写错误时表现得与命令相似。例如：</p>
<h2 id="Command-结构"><a href="#Command-结构" class="headerlink" title="Command 结构"></a>Command 结构</h2><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">type</span> Command <span class="keyword">struct</span>&#123;</span><br><span class="line">  <span class="comment">// 具体的指令</span></span><br><span class="line">  Use <span class="type">string</span> </span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 注释简短介绍</span></span><br><span class="line">  Short <span class="type">string</span> </span><br><span class="line">  <span class="comment">//预期的参数 type PositionalArgs func(cmd *Command, args []string) error</span></span><br><span class="line">  Args PositionalArgs</span><br><span class="line">  <span class="comment">// 长注释，通过-h --help来展示</span></span><br><span class="line">  Long <span class="type">string</span> </span><br><span class="line">  <span class="comment">// 对命令的使用做一个简单的示例，在-h的时候会展示</span></span><br><span class="line">  Example <span class="type">string</span></span><br><span class="line">  <span class="comment">// PreRun方法之前执行，并且子命令一样会执行</span></span><br><span class="line">  PersistentPreRun <span class="function"><span class="keyword">func</span><span class="params">(cmd *Command, args []<span class="type">string</span>)</span></span></span><br><span class="line"> <span class="comment">// PreRun方法之前执行，并且子命令一样会执行，返回一个error，如果该方法重写那么PersistentPreRun不会执行</span></span><br><span class="line">  PersistentPreRunE <span class="function"><span class="keyword">func</span><span class="params">(cmd *Command, args []<span class="type">string</span>)</span></span> <span class="type">error</span></span><br><span class="line">  <span class="comment">// Run函数执行前执行</span></span><br><span class="line">  PreRun <span class="function"><span class="keyword">func</span><span class="params">(cmd *Cmmand,args []<span class="type">string</span>)</span></span>  </span><br><span class="line">  <span class="comment">// Run函数执行前执行,返回一个error,如果重写了这个方法，PreRun不会执行</span></span><br><span class="line">  PreRunE <span class="function"><span class="keyword">func</span><span class="params">(cmd *Command, args []<span class="type">string</span>)</span></span> <span class="type">error</span></span><br><span class="line">  <span class="comment">// 命令真正执行的函数，大多数命令都只会实现这个方法</span></span><br><span class="line">  Run <span class="function"><span class="keyword">func</span><span class="params">(cmd *Command,args []<span class="type">string</span>)</span></span></span><br><span class="line">  <span class="comment">// 命令执行的函数，但是会返回一个error，如果实现了这个方法那么Run方法不会再继续执行</span></span><br><span class="line">  RunE <span class="function"><span class="keyword">func</span><span class="params">(cmd *Command,args []<span class="type">string</span>)</span></span><span class="type">error</span></span><br><span class="line">  <span class="comment">// 该函数执行发生在 Run的方法之后</span></span><br><span class="line">  PostRun <span class="function"><span class="keyword">func</span><span class="params">(cmd *Command,args []<span class="type">string</span>)</span></span></span><br><span class="line">  <span class="comment">// 该函数执行发生在 Run的方法之后，返回一个error,如果重写了这个方法那么PostRun方法将不会执行</span></span><br><span class="line">  PostRunE <span class="function"><span class="keyword">func</span><span class="params">(cmd *Command,args []<span class="type">string</span>)</span></span><span class="type">error</span></span><br><span class="line">  <span class="comment">// 该函数执行发生在PostRun之后，并且子命令也会执行</span></span><br><span class="line">  PersistentPostRun(cmd *Command,args []<span class="type">string</span>)</span><br><span class="line">  <span class="comment">// 该函数执行发生在PostRun之后， 并且子命令也会执行，返回一个error，如果重写了这个方法，那么PersistentPostRun不会再执行</span></span><br><span class="line">  PersistentPostRunE <span class="function"><span class="keyword">func</span><span class="params">(cmd *Command, args []<span class="type">string</span>)</span></span> <span class="type">error</span></span><br><span class="line">  <span class="comment">// 开启建议</span></span><br><span class="line">  SuggestionsMinimumDistance <span class="type">int</span></span><br><span class="line">  <span class="comment">// 开启建议命令</span></span><br><span class="line">  SuggestFor []<span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
        
            <div id="toc-article">
                
  <div class="widget-wrap" id="toc-wrap">
    <h3 class="widget-title"><i class="fa fa-toc"></i> 文章目录</h3>
    <div class="widget">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%A7%88"><span class="toc-text">概览</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AC%E6%96%87%E7%9A%84%E6%A0%B8%E5%BF%83%E7%9B%AE%E7%9A%84%E4%B8%BA%EF%BC%9A-%E9%80%9A%E8%BF%87%E6%89%8B%E5%86%99%E4%B8%80%E4%B8%AA%E7%A4%BA%E4%BE%8B%E6%9D%A5%E8%BF%85%E9%80%9F%E5%85%A5%E9%97%A8cobra"><span class="toc-text">本文的核心目的为： 通过手写一个示例来迅速入门cobra</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81-%E4%BD%BF%E7%94%A8cobra%E5%BB%BA%E8%AE%AE%E7%9A%84%E9%A1%B9%E7%9B%AE%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-text">一、 使用cobra建议的项目目录结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8cobra%E5%BA%93"><span class="toc-text">使用cobra库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BArootCmd%E6%96%87%E4%BB%B6"><span class="toc-text">创建rootCmd文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%BD%A0%E7%9A%84-main-go"><span class="toc-text">创建你的 main.go</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%99%84%E5%8A%A0%E5%91%BD%E4%BB%A4"><span class="toc-text">创建附加命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%92%8C%E5%A4%84%E7%90%86%E9%94%99%E8%AF%AF"><span class="toc-text">返回和处理错误</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%A0%87%E5%BF%97"><span class="toc-text">使用标志</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E5%91%BD%E4%BB%A4%E5%88%86%E9%85%8D%E6%A0%87%E5%BF%97"><span class="toc-text">为命令分配标志</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%89%E4%B8%A4%E7%A7%8D%E4%B8%8D%E5%90%8C%E7%9A%84%E6%96%B9%E6%B3%95%E6%9D%A5%E5%88%86%E9%85%8D%E6%A0%87%E5%BF%97%E3%80%82"><span class="toc-text">有两种不同的方法来分配标志。</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%81%E4%B9%85%E6%A0%87%E5%BF%97"><span class="toc-text">持久标志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E6%A0%87%E5%BF%97"><span class="toc-text">本地标志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%88%B6%E5%91%BD%E4%BB%A4%E7%9A%84%E6%9C%AC%E5%9C%B0%E6%A0%87%E5%BF%97"><span class="toc-text">父命令的本地标志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E9%85%8D%E7%BD%AE%E7%BB%91%E5%AE%9A%E6%A0%87%E5%BF%97"><span class="toc-text">使用配置绑定标志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%85%E9%9C%80%E7%9A%84%E6%A0%87%E5%BF%97"><span class="toc-text">必需的标志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%87%E5%BF%97%E7%BB%84"><span class="toc-text">标志组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%8D%E7%BD%AE%E5%92%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8F%82%E6%95%B0"><span class="toc-text">位置和自定义参数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90"><span class="toc-text">例子</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%AE%E5%8A%A9%E5%91%BD%E4%BB%A4"><span class="toc-text">帮助命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E4%BD%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E5%B8%AE%E5%8A%A9"><span class="toc-text">定义你自己的帮助</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%B3%95"><span class="toc-text">用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%88%E6%9C%AC%E6%A0%87%E5%BF%97"><span class="toc-text">版本标志</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PreRun-%E5%92%8C-PostRun-%E6%8C%82%E9%92%A9"><span class="toc-text">PreRun 和 PostRun 挂钩</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%91%E7%94%9F%E2%80%9C%E6%9C%AA%E7%9F%A5%E5%91%BD%E4%BB%A4%E2%80%9D%E6%97%B6%E7%9A%84%E5%BB%BA%E8%AE%AE"><span class="toc-text">发生“未知命令”时的建议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Command-%E7%BB%93%E6%9E%84"><span class="toc-text">Command 结构</span></a></li></ol>
    </div>
  </div>


            </div>
        
        
          <blockquote id="copyright">
              <p>原文链接: <a href="https://weixiaodong.github.io/2023/03/09/go-每日一库之-cobra/">https://weixiaodong.github.io/2023/03/09/go-每日一库之-cobra/</a></p>
              <p>版权声明: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          
    <div class="article-reward">
        <a id="reward-btn" href="javascript:;">打赏</a>
        <div id="reward-content">
            <h6 class="reward-tit">“感谢你的支持，我会继续努力！”</h6>
            <div>
                <div class="reward-code">
                    <img class="type-code" src="/css/images/wechat.jpg">
                    <img class="er-code" src="/css/images/wechat-pay.png">
                </div>
                <div class="reward-code">
                    <img class="type-code" src="/css/images/alipay.jpg">
                    <img class="er-code" src="/css/images/alipay-pay.png">
                </div>
            </div>
            <p class="reward-desc">扫码打赏，感谢支持</p>
        </div>
    </div>


          
          
    <div class="social-share">
      <span>分享到:</span>
    </div>



        </div>
      
      
        
<nav id="article-nav">
  
    <a href="/2023/03/08/go-flag%E5%8C%85%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">older</strong>
      <div class="article-nav-title">
        
          go flag包源码阅读
        
      </div>
    </a>
  
  
    <a href="/2023/03/10/go-%E6%AF%8F%E6%97%A5%E4%B8%80%E5%BA%93%E4%B9%8B-cobra-cli%E4%BD%BF%E7%94%A8/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">newer</strong>
      <div class="article-nav-title">
        
          go-每日一库之-cobra-cli使用
        
      </div>
    </a>
  
</nav>

      
      
        


  <section id="comments" class="vcomment"></section>







      
    </footer>
  </div>
</article>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-posts"></i> 最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/03/10/go-%E6%AF%8F%E6%97%A5%E4%B8%80%E5%BA%93%E4%B9%8B-cobra-cli%E4%BD%BF%E7%94%A8/">go-每日一库之-cobra-cli使用</a>
          </li>
        
          <li>
            <a href="/2023/03/09/go-%E6%AF%8F%E6%97%A5%E4%B8%80%E5%BA%93%E4%B9%8B-cobra/">go-每日一库之-cobra</a>
          </li>
        
          <li>
            <a href="/2023/03/08/go-flag%E5%8C%85%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/">go flag包源码阅读</a>
          </li>
        
          <li>
            <a href="/2023/03/07/go-%E6%AF%8F%E6%97%A5%E4%B8%80%E5%BA%93%E4%B9%8B-flag/">go 每日一库之 flag</a>
          </li>
        
      </ul>
    </div>
  </div>


  
    
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-archive"></i> 归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/">2023年</a><span class="archive-list-count">4</span></li></ul>
    </div>
  </div>


  
    

  
    

  
</aside>
        
      </div>
      <a id="totop" href="#top"></a>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <p>
        <a href="/sitemap.xml">网站地图</a>
        <span> | </span><a href="/atom.xml">订阅本站</a>
        <span> | </span><a href="/about/">联系博主</a>
      </p>
      
        <p>
          <i class="fa fa-visitors"></i>
          <i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>
          ，
          <i class="fa fa-views"></i>
          <i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>
        </p>
      
      <p>
        <span>Copyright &copy; 2023 卫小栋.</span>
        <span>Theme by <a href="https://github.com/chaooo/hexo-theme-BlueLake/" target="_blank">BlueLake.</a></span>
        <span>Powered by <a href="https://hexo.io/" target="_blank">Hexo.</a></span>
      </p>
    </div>
  </div>
</footer>

    </div>
  </div>
  
<script src="/js/jquery-3.4.1.min.js"></script>


<script src="/js/search.json.js"></script>


  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>






  
<script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  
    
<script src="/localshare/js/social-share.js"></script>

    
<script src="/localshare/js/qrcode.js"></script>

  
  



  

  

  
    
<script src="https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js"></script>

    <script>
      var GUEST_INFO = ['nick','mail','link'];
      var guest_info = 'nick,mail,link'.split(',').filter(function(item){
          return GUEST_INFO.indexOf(item) > -1
      });
      var notify = 'false' == true;
      var verify = 'false' == true;
      new Valine({
          el: '.vcomment',
          notify: notify,
          verify: verify,
          appId: "Ao8Phc6VLirvJSnGnlUY8gng-9Nh9j0Va",
          appKey: "uoKVJAn0RJKvNZTi3f2wPRla",
          placeholder: "Just go go",
          pageSize:'10',
          avatar:'mm',
          lang:'zh-cn'
      });
    </script>
  

  

  

  

  

  
  





</body>
</html>